version: '{build}'

environment:
  RELEASE_KEY_SECRET:
    secure: qK/vt4/ihLipeamB7l+Dng==

install:
  - if defined RELEASE_KEY_SECRET (nuget install secure-file -ExcludeVersion -Verbosity quiet && secure-file\tools\secure-file -decrypt net\DevExtreme.AspNet.Data\release.snk.enc -secret %RELEASE_KEY_SECRET%)
  - powershell -File build\replace-meta.ps1 %APPVEYOR_BUILD_NUMBER% %APPVEYOR_REPO_TAG_NAME%
  - npm install
  - dotnet restore net\DevExtreme.AspNet.Data.sln
  - nuget restore net\DevExtreme.AspNet.Data.sln -Verbosity quiet

build_script:
  - dotnet build net\DevExtreme.AspNet.Data.sln

test_script:
  - npm test
  - dotnet test net\DevExtreme.AspNet.Data.Tests\DevExtreme.AspNet.Data.Tests.csproj
  - xunit.console.clr4 net\DevExtreme.AspNet.Data.Tests.NET40\bin\Debug\DevExtreme.AspNet.Data.Tests.dll /appveyor

after_test:
  - npm pack
  - if defined RELEASE_KEY_SECRET dotnet pack net\DevExtreme.AspNet.Data --configuration=Release

artifacts:
  - path: net\DevExtreme.AspNet.Data\bin\Release\*.nupkg
  - path: devextreme-aspnet-data-*.tgz 
